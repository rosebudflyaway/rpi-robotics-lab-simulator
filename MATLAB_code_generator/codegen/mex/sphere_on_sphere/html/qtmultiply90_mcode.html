<pre class="code">
<span class="srcline"><span class="lineno"><a href="42,1" id="srcline1"> 1</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="42,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">% Return the *UNIT* quaternion multiplication of q and r.</span></span></span>
<span class="srcline"><span class="lineno"><a href="42,3" id="srcline3"> 3</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T20U3">qout</span> = qtmultiply(<span class="var type1" id="S3T20U6">q</span>,<span class="var type1" id="S4T20U7">r</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="42,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="42,5" id="srcline5"> 5</a></span><span class="line">    <span class="keyword">if</span> size(<span class="var type1" id="S3T20U14">q</span>,1)~=4 || size(<span class="var type1" id="S4T20U20">r</span>,1)~=4, error(<span class="string">'q and r must be 4-by-1'</span>); <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="42,6" id="srcline6"> 6</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="42,7" id="srcline7"> 7</a></span><span class="line">    <span class="mxinfo" id="T20:U6"><span class="var type1" id="S2T20U29">qout</span> = <span class="mxinfo" id="T20:U8">[ <span class="mxinfo" id="T1:U9"><span class="mxinfo" id="T1:U10"><span class="mxinfo" id="T1:U11"><span class="mxinfo" id="T1:U12"><span class="mxinfo" id="T1:U13"><span class="var type1" id="S3T20U37">q</span>(<span class="mxinfo" id="T1:U15">1</span>)</span>*<span class="mxinfo" id="T1:U16"><span class="var type1" id="S4T20U40">r</span>(<span class="mxinfo" id="T1:U18">1</span>)</span></span> - <span class="mxinfo" id="T1:U19"><span class="mxinfo" id="T1:U20"><span class="var type1" id="S3T20U44">q</span>(<span class="mxinfo" id="T1:U22">2</span>)</span>*<span class="mxinfo" id="T1:U23"><span class="var type1" id="S4T20U47">r</span>(<span class="mxinfo" id="T1:U25">2</span>)</span></span></span> - <span class="mxinfo" id="T1:U26"><span class="mxinfo" id="T1:U27"><span class="var type1" id="S3T20U51">q</span>(<span class="mxinfo" id="T1:U29">3</span>)</span>*<span class="mxinfo" id="T1:U30"><span class="var type1" id="S4T20U54">r</span>(<span class="mxinfo" id="T1:U32">3</span>)</span></span></span> - <span class="mxinfo" id="T1:U33"><span class="mxinfo" id="T1:U34"><span class="var type1" id="S3T20U58">q</span>(<span class="mxinfo" id="T1:U36">4</span>)</span>*<span class="mxinfo" id="T1:U37"><span class="var type1" id="S4T20U61">r</span>(<span class="mxinfo" id="T1:U39">4</span>)</span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="42,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo" id="T20:U6"><span class="mxinfo" id="T20:U8">             <span class="mxinfo" id="T1:U40"><span class="mxinfo" id="T1:U41"><span class="mxinfo" id="T1:U42"><span class="mxinfo" id="T1:U43"><span class="mxinfo" id="T1:U44"><span class="var type1" id="S3T20U69">q</span>(<span class="mxinfo" id="T1:U46">1</span>)</span>*<span class="mxinfo" id="T1:U47"><span class="var type1" id="S4T20U72">r</span>(<span class="mxinfo" id="T1:U49">2</span>)</span></span> + <span class="mxinfo" id="T1:U50"><span class="mxinfo" id="T1:U51"><span class="var type1" id="S3T20U76">q</span>(<span class="mxinfo" id="T1:U53">2</span>)</span>*<span class="mxinfo" id="T1:U54"><span class="var type1" id="S4T20U79">r</span>(<span class="mxinfo" id="T1:U56">1</span>)</span></span></span> + <span class="mxinfo" id="T1:U57"><span class="mxinfo" id="T1:U58"><span class="var type1" id="S3T20U83">q</span>(<span class="mxinfo" id="T1:U60">3</span>)</span>*<span class="mxinfo" id="T1:U61"><span class="var type1" id="S4T20U86">r</span>(<span class="mxinfo" id="T1:U63">4</span>)</span></span></span> - <span class="mxinfo" id="T1:U64"><span class="mxinfo" id="T1:U65"><span class="var type1" id="S3T20U90">q</span>(<span class="mxinfo" id="T1:U67">4</span>)</span>*<span class="mxinfo" id="T1:U68"><span class="var type1" id="S4T20U93">r</span>(<span class="mxinfo" id="T1:U70">3</span>)</span></span></span></span></span> </span></span>
<span class="srcline"><span class="lineno"><a href="42,9" id="srcline9"> 9</a></span><span class="line"><span class="mxinfo" id="T20:U6"><span class="mxinfo" id="T20:U8">             <span class="mxinfo" id="T1:U71"><span class="mxinfo" id="T1:U72"><span class="mxinfo" id="T1:U73"><span class="mxinfo" id="T1:U74"><span class="mxinfo" id="T1:U75"><span class="var type1" id="S3T20U101">q</span>(<span class="mxinfo" id="T1:U77">1</span>)</span>*<span class="mxinfo" id="T1:U78"><span class="var type1" id="S4T20U104">r</span>(<span class="mxinfo" id="T1:U80">3</span>)</span></span> - <span class="mxinfo" id="T1:U81"><span class="mxinfo" id="T1:U82"><span class="var type1" id="S3T20U108">q</span>(<span class="mxinfo" id="T1:U84">2</span>)</span>*<span class="mxinfo" id="T1:U85"><span class="var type1" id="S4T20U111">r</span>(<span class="mxinfo" id="T1:U87">4</span>)</span></span></span> + <span class="mxinfo" id="T1:U88"><span class="mxinfo" id="T1:U89"><span class="var type1" id="S3T20U115">q</span>(<span class="mxinfo" id="T1:U91">3</span>)</span>*<span class="mxinfo" id="T1:U92"><span class="var type1" id="S4T20U118">r</span>(<span class="mxinfo" id="T1:U94">1</span>)</span></span></span> + <span class="mxinfo" id="T1:U95"><span class="mxinfo" id="T1:U96"><span class="var type1" id="S3T20U122">q</span>(<span class="mxinfo" id="T1:U98">4</span>)</span>*<span class="mxinfo" id="T1:U99"><span class="var type1" id="S4T20U125">r</span>(<span class="mxinfo" id="T1:U101">2</span>)</span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="42,10" id="srcline10">10</a></span><span class="line"><span class="mxinfo" id="T20:U6"><span class="mxinfo" id="T20:U8">             <span class="mxinfo" id="T1:U102"><span class="mxinfo" id="T1:U103"><span class="mxinfo" id="T1:U104"><span class="mxinfo" id="T1:U105"><span class="mxinfo" id="T1:U106"><span class="var type1" id="S3T20U133">q</span>(<span class="mxinfo" id="T1:U108">1</span>)</span>*<span class="mxinfo" id="T1:U109"><span class="var type1" id="S4T20U136">r</span>(<span class="mxinfo" id="T1:U111">4</span>)</span></span> + <span class="mxinfo" id="T1:U112"><span class="mxinfo" id="T1:U113"><span class="var type1" id="S3T20U140">q</span>(<span class="mxinfo" id="T1:U115">2</span>)</span>*<span class="mxinfo" id="T1:U116"><span class="var type1" id="S4T20U143">r</span>(<span class="mxinfo" id="T1:U118">3</span>)</span></span></span> - <span class="mxinfo" id="T1:U119"><span class="mxinfo" id="T1:U120"><span class="var type1" id="S3T20U147">q</span>(<span class="mxinfo" id="T1:U122">3</span>)</span>*<span class="mxinfo" id="T1:U123"><span class="var type1" id="S4T20U150">r</span>(<span class="mxinfo" id="T1:U125">2</span>)</span></span></span> + <span class="mxinfo" id="T1:U126"><span class="mxinfo" id="T1:U127"><span class="var type1" id="S3T20U154">q</span>(<span class="mxinfo" id="T1:U129">4</span>)</span>*<span class="mxinfo" id="T1:U130"><span class="var type1" id="S4T20U157">r</span>(<span class="mxinfo" id="T1:U132">1</span>)</span></span></span> ]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="42,11" id="srcline11">11</a></span><span class="line">         </span></span>
<span class="srcline"><span class="lineno"><a href="42,12" id="srcline12">12</a></span><span class="line"><span class="comment">%     qout = [ q(1)*r(1) - q(2)*r(2) - q(3)*r(3) - q(4)*r(4)</span></span></span>
<span class="srcline"><span class="lineno"><a href="42,13" id="srcline13">13</a></span><span class="line"><span class="comment">%              q(2)*r(1) + q(1)*r(2) - q(4)*r(3) + q(3)*r(4)</span></span></span>
<span class="srcline"><span class="lineno"><a href="42,14" id="srcline14">14</a></span><span class="line"><span class="comment">%              q(3)*r(1) + q(4)*r(2) + q(1)*r(3) - q(2)*r(4)</span></span></span>
<span class="srcline"><span class="lineno"><a href="42,15" id="srcline15">15</a></span><span class="line"><span class="comment">%              q(4)*r(1) - q(3)*r(2) + q(2)*r(3) + q(1)*r(4) ]; </span></span></span>
<span class="srcline"><span class="lineno"><a href="42,16" id="srcline16">16</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="42,17" id="srcline17">17</a></span><span class="line">    <span class="mxinfo" id="T20:U133"><span class="var type1" id="S2T20U161">qout</span> = <span class="mxinfo" id="T20:U135"><span class="var type1" id="S2T20U163">qout</span> / <span class="mxinfo" id="T1:U137">norm(<span class="var type1" id="S2T20U166">qout</span>)</span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="42,18" id="srcline18">18</a></span><span class="line"><span class="keyword">end</span>       </span></span>
</pre>
